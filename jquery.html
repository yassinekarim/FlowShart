<!doctype html>
<html>
<head>

    <title>Flow</title>
    <meta http-equiv="content-type" content="text/html;charset=utf-8" />
    <link href="./css/bootstrap.min.css" rel="stylesheet">
    <!-- Custom styles for this template -->
    <!-- <link href="starter-template.css" rel="stylesheet"> -->
    <link rel="stylesheet"
    href="http://code.jquery.com/ui/1.9.2/themes/smoothness/jquery-ui.css" />
    <link href="http://netdna.bootstrapcdn.com/font-awesome/4.0.1/css/font-awesome.css" rel="stylesheet">
    <link rel="stylesheet" href="css/jsplumb.css">
    <link rel="stylesheet" href="css/demo.css">
</head>
<body  data-library="jquery">




        <!-- <div id="main">
           
            <div class="demo flowchart-demo" id="flowchart-demo">
                <div class="window" id="flowchartWindow1"><strong>1</strong><br/><br/></div>
                <div class="window" id="flowchartWindow2"><strong>2</strong><br/><br/></div>
                <div class="window" id="flowchartWindow3"><strong>3</strong><br/><br/></div>
                <div class="window" id="flowchartWindow4"><strong>4</strong><br/><br/></div>             
            </div>
        </div>     -->
        

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
      <![endif]-->
       <script src="js/jquery-1.10.2.js"></script>
    <script src="js/jquery-ui-1.10.4.min.js"></script>
    <script src="js/jquery.ui.touch-punch.min.js"></script>     
     <script type="text/javascript">
     //parseur condition ***********************************************************
     var Car_Cour="";
     var position=0;
     var sym_cour={};
     function lire_car(condition)
    {
      Car_Cour=condition[position];
      position++;
    }

function lire_mot()
{

  sym_cour.CH=Car_Cour;
  lire_car();
  while ((Car_Cour >='0' && Car_Cour<='9') || (Car_Cour >='a' && Car_Cour<='z') || (Car_Cour >='A' && Car_Cour<='Z') )
  {


      sym_cour.CH=sym_cour.CH.concat(Car_Cour);
      lire_car();

  }
  sym_cour.cl="ID_TOKEN";
}

function lire_nombre()
{
  sym_cour.CH=Car_Cour;
  lire_car();
  while ((Car_Cour >='0' && Car_Cour<='9') )
  {
      sym_cour.CH=sym_cour.CH.concat(Car_Cour);
      lire_car();

  }
  sym_cour.cl="INUM_TOKEN";
  if (Car_Cour== '.')
  {
    lire_car();
    while ((Car_Cour >='0' && Car_Cour<='9') )
    {
      sym_cour.CH=sym_cour.CH.concat(Car_Cour);

      lire_car();

    }
    sym_cour.cl="DNUM_TOKEN";
  }
}

function symbole_suivant()
{
  while (Car_Cour==' '|| Car_Cour=='\n'||Car_Cour=='\t')
  {

    lire_car();
  }
 
  
  
  if ((Car_Cour >= 'A' && Car_Cour <= 'Z') || (Car_Cour >= 'a' && Car_Cour <= 'z'))
    lire_mot();
  else
    if (Car_Cour >='0' && Car_Cour<='9')
      lire_nombre();
    else
      switch (Car_Cour)
      { //catégorie des sym spe.
        case '(': sym_cour.cl="PO_TOKEN"; lire_car();break;
        case ')': sym_cour.cl = "PF_TOKEN"; lire_car();break;
        case '.': sym_cour.cl="PT_TOKEN"; lire_car();break;
        case ',': sym_cour.cl="VIR_TOKEN"; lire_car();break;
        case '+': sym_cour.cl ="PLUS_TOKEN"; lire_car();break;
        case '-': sym_cour.cl = "MOINS_TOKEN"; lire_car();break;
        case '*': sym_cour.cl = "MULT_TOKEN"; lire_car();break;
        case '%': sym_cour.cl = "MOD_TOKEN"; lire_car();break;
        case "\0": sym_cour.cl = "END_TOKEN"; lire_car();break;
        case '"': sym_cour.cl = "STR_TOKEN"; lire_car();break;
        case '<': sym_cour.cl= "INF_TOKEN"; lire_car();
          if (Car_Cour=='=')
          {
            sym_cour.cl = "INFEG_TOKEN";
            lire_car();
          }
           break;
        case '>': sym_cour.cl= "SUP_TOKEN"; lire_car();
          if (Car_Cour=='=')
          {
            sym_cour.cl = "SUPEG_TOKEN";
            lire_car();
          } break;
        case '=': sym_cour.cl = "AFF_TOKEN";lire_car();
          if (Car_Cour=='=')
          {
            sym_cour.cl = "EGAL_TOKEN";
            lire_car();
          }
           break;
        case '!': sym_cour.cl = "NON_TOKEN";lire_car();
          if (Car_Cour=='=')
          {
            sym_cour.cl = "DIFF_TOKEN";
            lire_car();
          }
        case '|':lire_car();
          if (Car_Cour=='|')
          {
            sym_cour.cl = "OR_TOKEN";
            lire_car();
          }
          else{ alert("erreur token | non reconnue (or == || )");}
        case '&':  lire_car();
          if (Car_Cour=='&')
          {
            sym_cour.cl = "AND_TOKEN";
            lire_car();
          }
          else{ alert("erreur token & non reconnue (or == && )");}
        break;
        default : alert("erreur token "+Car_Cour+" non reconnue");lire_car();break;

      }
  
}
function compilation_unit(liste)
{
    while(sym_cour.cl!="END_TOKEN")
    {
        if (type_declaration(liste))
        {

        }
        else return false ;
    }
    return true ;


}


     //fin parseur condition ************************************************************
         var compteurId = 0;
        function getSelected()
        {
          var panel=$("#panelSaisi");
          var id;
          var type;
           id=panel.attr("selectedElement");
          if(id!="" &&id!= undefined)
           {
            type="element";
            return {Id:id,Type:type};
          }
          id=panel.attr("selectedXor");
          if(id!="" &&id!= undefined)
            {
              type="xor";
              return {Id:id,Type:type};
            }
          id=panel.attr("selectedConn");
          if(id!="" &&id!= undefined)
            {
              type="connection";
              return {Id:id,Type:type};
            }
            alert('no selected element');
          return {};
        }
        function desselectAll () {
        $(".node").css("border", "");
        $(".xor2").css("border", "");
        $(".panelInfo").css("display", "none");
        var input = $("#panelSaisi");
        input.attr("selectedElement", "");
        input.attr("selectedConn","");
        input.attr("selectedXor","");
        var connections=window.instance.getAllConnections();
                for (var i = 0; i < connections.length; i++) {
                    connections[i].setPaintStyle({strokeStyle:"#61B7CF",lineWidth : 1})
                }
    
    }
        function setSelectedRed(element) {

        desselectAll();
        $("#" + element).css("border", "2px solid red");
    }
    function applyUpdateInfo(id, attribute) {
        var globalinput = $("#panelSaisi");
        var element = $("#" + globalinput.attr("selectedElement"));
        var input = $('#' + id);
        element.attr(attribute, input.prop("value"));
        if (attribute == "nom")
            element.text(input.prop("value"));
    }function parseCondition(string){
      lire_car();
      symbole_suivant();

    }
    function setCondition(){
        var globalinput = $("#panelSaisi");
        var data =  globalinput.attr("selectedConn");
        var arr = data.split('|');
        var xor=$("#flowchart"+arr[0]);
        var input = $('#inputCondition');
        xor.attr(arr[1], input.prop("value"));


    }
    function supprimmer(){
      var selected=getSelected();
      if(selected!={})
      {
        var endpoint=window.instance.getEndpoint ( selected.Id ) ;
        if(selected.Type=="connection")
        {
          
          var connections=endpoint.connections
          for (var i = 0; i < connections.length; i++) {
            window.instance.detach(connections[i]);
          }
        }
        else{
          var endpoints=window.instance.getEndpoints ( selected.Id );
          for (var i = 0; i < endpoints.length; i++) {
            window.instance.deleteEndpoint(endpoints[i]);
          }
          $("#"+selected.Id).remove();

        }
      }


    }
    function showPanel(id) {

        var td = $("#panelSaisi");
        td.children().css("display", "none");
        var panel = $(id);
        var selected=getSelected();
        
        if (selected!={}){ 
          if (((id=="#detailEtape"||id=="#detailRubrique")&&selected.Type=="element")||(id=="#detailCondition"&&selected.Type=="connection"))
            panel.css("display", "block");
         else
            alert("no suitable element selected");
        }
    }
    function isAllnodeVisited()
    {
        var nodes=$(".node");
        var xors=$(".xor2");
        for (var i = 0; i < nodes.length; i++) {
            if(nodes[i].getAttribute("visited")!="true")
                {
                  setSelectedRed(nodes[i].getAttribute("id"))
                  alert("le noeud selectionné en rouge n'est pas accessible");
                  return false;}
        }
        for (var i = 0; i < xors.length; i++) {
            if(xors[i].getAttribute("visited")!="true")
                {
                  setSelectedRed(xors[i].getAttribute("id"))
                  alert("le xor selectionné en rouge n'est pas accessible");
                  return false;}
        }
        return true;
    }
    
    function getData(element, jsonData) {
        var visited = element.attr("visited");
        if (visited == "true") {
            jsonData.Id = element.attr("idFlowChart");
            return true;
        } 
        else {
            if(!element.hasClass("xor2"))
            {
                var nom = element.attr("nom");
                var dateDebut = element.attr("dateDebut");
                var dateFin = element.attr("dateFin");
                element.attr("visited", "true");
                var id = compteurId++;
                element.attr("idFlowChart", id);
                if (nom == undefined || dateDebut == undefined || dateFin == undefined || nom == ""|| dateDebut == "" || dateFin == ""){
                    setSelectedRed(element.attr("id"))
                  alert("des information sont manquante au noeud selectionné");
                    return false;
                }
            
                else {
                  jsonData.Id = id;
                  jsonData.nom = nom;
                  jsonData.dateDebut = dateDebut;
                  jsonData.dateFin = dateFin;
                  if(element.hasClass("stop2"))
                  {
                    return true;
                  }
                  var connections=window.instance.getConnections({source:element.attr("id")});
                  if (connections.length==0||connections.length>1)
                  {        
                     setSelectedRed(element.attr("id"))
                        alert("ce noeud as "+connections.length+" element suivant ");
                    return false;
                  }

                  
                    var jsonNext ={};
                    var nextElement=$("#"+connections[0].targetId);
                    if (nextElement.hasClass("xor2")){
                      jsonNext=[];
                      jsonData.Type="xor"
                    }
                      
                    if (getData(nextElement , jsonNext))
                    {
                      jsonData.Next=jsonNext;
                    }
                    else{
                     return false; 
                    }
                            
                  
                }
            }else{
              element.attr("visited", "true");
              var connections=window.instance.getConnections({source:element.attr("id")});
                  if (connections.length==0)
                  {        
                     setSelectedRed(element.attr("id"))
                        alert("ce noeud n'as pas d'element suivant ");
                    return false;
                  }
                  var jsonNext = {};
                    var nextElement;
                  for (var i = 0; i < connections.length; i++) {
                    jsonNext = {};
                    nextElement=$("#"+connections[i].targetId);
                    if (getData(nextElement , jsonNext))
                    {
                      jsonData.push(jsonNext);
                    }
                    else{
                     return false; 
                    }
                  
                  }

            }
            return true;
      }
      

    }
    function isValid(e) {
      e.preventDefault();
        $(".node").attr("visited","");
        $(".xor2").attr("visited","");
        var start = $(".start2");
        var jsonData ={};
        if (start.length != 1)
           {

            alert('il y as '+start.length+' element start')
            return false;
           } 
        if (getData(start, jsonData)) {
            var visit= isAllnodeVisited();
            if (visit) {
              var flowChartJson = JSON.stringify(jsonData);
              alert(flowChartJson)
              $('#jsonText').prop("value",flowChartJson)
            }
            return visit
        }

        else
        {

          return false;

        }
            

    }
     </script>
    
      <table style="position:absolute; left:100px; top:100px;">
        <tr>
            <td style="width: 100px; height: 25px;">
            </td>
            <td style="width: 200px; height: 25px;"  >
               <button onclick="javascript:showPanel('#detailEtape')">detail etape</button> 
               <button onclick="javascript:showPanel('#detailRubrique')">detail Rubrique</button>
               <button onclick="javascript:supprimmer()">supprimer</button>

            </td>
            <td style="width: 200px; height: 25px;">
                <button onclick="javascript:showPanel('#detailCondition')">detail condition</button>
                <form onsubmit="javascript:isValid(event);" action="#" method="post">
                  <input  id="jsonText" type="hidden" name="json"  />
                  <input type="submit" name="compiler" value="compiler" />
                </form>
            </td>
            <td colspan="2" style="width: 300px; height: 25px;">
                 
            </td>
        </tr>
        <tr>
            <td style="width: 100px; height: 100px;">
                <div class="tache" style="width: 50px; height: 50px;margin:auto;display: block; cursor: auto;"></div>
            </td>
            <td  colspan="2" rowspan="4">
                <div class="deposer flowchart-demo container"  id="flowchart"
                style="display: block;overflow: auto;background-color: white"></div>
            </td>
            <td   id="panelSaisi" colspan="2" rowspan="4" >
              <div id="detailEtape" class="panelInfo" style="display:none">
                 <center><b>detail etape</b></center><br/>
                 <br/>
                Nom :&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <input   id="inputNom" type="text"  onchange="javascript:applyUpdateInfo('inputNom','nom')"  /><br/><br/>
                Date Debut :<input id="inputdateDebut" type="date"  onchange="javascript:applyUpdateInfo('inputdateDebut','dateDebut')"  /><br/><br/>
                Date Fin :&nbsp;&nbsp;&nbsp; <input id="inputdateFin" type="date"  onchange="javascript:applyUpdateInfo('inputdateFin','dateFin')"  /><br/><br/>
              </div>
              <div id="detailRubrique" class="panelInfo" style="display:none">
                Nom :&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <input   id="inputNom1" type="text"  onchange="javascript:applyUpdateInfo('inputNom1','nom1')"  /><br/><br/>
              </div>
              <div id="detailCondition"  class="panelInfo" style="display:none">
                condition :&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <input   id="inputCondition" type="text"  onchange="javascript:setCondition();"  /><br/><br/>
              </div>
            </td>
             <!--debut ajout/-->
              <!--td   id="detailrub" colspan="2" rowspan="4" style="display:none">
                 <center><b>detail rubrique</b></center><br/>
          <div class="table_content">    
                 <aside style="width: 900px; ">
                 <center>
        <div id="container">
            <div id="demo_jui">
          <center>  <table   id="companie" class="display">
                <thead>
                    <tr>
                                    <th style=" border: 0;">Nom de l'�tape</th>
                                    <th style=" border: 0;">type de l'�tape</th>
                                    
    
                         </tr>  
             </thead>
   <span class="niceform">  
    <tbody>
                                    
<c:forEach items="${Etape_generique}" var="m">
<c:if test="">

<tr>
<td> ${m.nom_etape_gen}  </td>
<td> 
${m.type_etape.NOM_TYPE_ETAPE}
</td>
<td>
<input type="radio" name="etape_gen" value="${m.code_etape_gen}"
</td>

 <td bgcolor="white">
  <a href="Editer_Lexique.do?id= ${m.n_lexique} " title="editer">
 <img src="images/edit.png"/>
  </a>
  </td>
  <td>
  <a href="supp_lexique.do?id= ${m.n_lexique} " onclick="if(window.confirm('vous voulez Supprimer cette ligne?')){return true;}else{return false;}" title="supprimer">
  
  <img src="images/supp.png"/>
  </a>
  </td>
 </tr>
 </c:forEach>
 </tbody>
  </table>
  </c:if>
</div>
</div>  
<c:if test="!empty id">

<table   id="companie" class="display">
                <thead>
                    <tr>
                                    <th style=" border: 0;">Nom de l'�tape</th>
                                    <th style=" border: 0;">type de l'�tape</th>
                                    
    
                         </tr>  
             </thead>
   <span class="niceform">  
    <tbody>
                                    
<c:forEach items="${rubrique}" var="m">
<c:if test="">

<tr>
<td> ${m.NOM_RUBRIQUE}  </td>
<td> 

</td>
<td>
<input type="radio" name="etape_gen" value="${m.NOM_RUBRIQUE}"
</td>

 <td bgcolor="white">
  <a href="Editer_Lexique.do?id= ${m.n_lexique} " title="editer">
 <img src="images/edit.png"/>
  </a>
  </td>
  <td>
  
  </td>
 </tr>
 </c:forEach>
 </tbody>
  </table>
< input type="submit" value="Ajouter" />
</c:if>        
      </td-->
<!--fin ajout/-->     
        </tr>

        <tr>
            <td style="width: 100px; height: 100px;">
                <div class="xor"
                style="margin: auto; display: block; "><div class="cross"
                style="margin: auto;"></div></div>
            </td>
            
        </tr> 
        <tr>
            <td style="width: 100px; height: 100px;">
                <div class="start" style="margin:auto;display: block; cursor: auto;"></div>
            </td>
        </tr>
        <tr>
            <td style="width: 100px; height: 100px;">

                <div class="stop" style="margin:auto;display: block; cursor: auto;"></div>

            </td>
        </tr>
    </table>

    <textarea id="jsonOutput" style="width:100%;height:100px;display:none"></textarea>



      
<!-- JS -->
    <!-- support lib for bezier stuff -->
   <script src="js/jsBezier-0.6.js"></script>     
      
    <script src="js/biltong-0.2.js"></script>
    
    <script src="js/util.js"></script>
    <script src="js/dom-adapter.js"></script>        
    
    <script src="js/jsPlumb.js"></script>
    <script src="js/endpoint.js"></script>                
    <script src="js/connection.js"></script>
    <script src="js/anchors.js"></script>        
    <script src="js/defaults.js"></script>
    <script src="js/connectors-bezier.js"></script>
    <script src="js/connectors-statemachine.js"></script>
    <script src="js/connectors-flowchart.js"></script>
    <script src="js/connector-editors.js"></script>
    <script src="js/renderers-svg.js"></script>


    <script src="js/renderers-vml.js"></script>

    <script src="js/jquery.jsPlumb.js"></script>
     
    
<script src="js/demo.js"></script>



<script src="js/bootstrap.min.js" type="text/javascript"></script>


</body>
</html>